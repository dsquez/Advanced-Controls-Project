% test double stance
clc
clear
close all

params.m = 1.45;    % mass (kg)
params.k = 8;  % spring constant (N/m)
params.g = 9.81; % gravity (m/s^2)
params.lambda_1 = 0.1; % length of primary link (m)
params.lambda_2 = 0.2; % length of secondary link (m)
params.stance = [ 0 0 ]; % position of stance point
params.br = 0; % damping in linear motion of leg
params.bt = 0; % torsional damping in leg

params.zeta_0 = 0.25; % nominal length of spring
params.landing_angle = pi + pi/6;

r1 = 1;
rsep = 0.5;
r2 = sqrt(r1^2+rsep^2-r1*rsep*cos(5*pi/4-params.landing_angle));
t1 = params.landing_angle;
t2 = atan2(r1*sin(5*pi/4-t1),r1*cos(5*pi/4-t1)-rsep);
eventfunc = @(t,y) double_stance_event(t,y,params);

option = odeset('Events',eventfunc);
odefun = @(t,y) eom_double_stance(t,y,params);
tspan = [ 0 10 ];
y0 = [ r1 0 r2 0 t1 0 t2 0 ];

[tout,yout] = ode45(odefun,tspan,y0,option);

figure()
subplot(221)
plot(tout,yout(:,1))

subplot(222)
plot(tout,yout(:,3))

subplot(223)
plot(tout,yout(:,5))

subplot(224)
plot(tout,yout(:,7))